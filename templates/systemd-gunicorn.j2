# This file was generated by Ansible for {{ansible_fqdn}}
# Do NOT modify this file by hand!

{% set app = item -%}
{% set run_dir = app.run_dir|default("/opt/%s/run" % app.name) -%}
{% set log_dir = app.log_dir|default("/opt/%s/log" % app.name) -%}
{% set etc_dir = app.etc_dir|default("/opt/%s/etc" % app.name) -%}
{% set env_dir = app.virtualenv|default("/opt/%s/env" % app.name) -%}
{% set app_dir = app.app_dir|default("/opt/%s/src" % app.name) -%}
{% set env = app.env|default({}) -%}
{% set env_file = app.env_file|default(wsgi_env_file) -%}

[Unit]
Description=Gunicorn Instance to serve {{ app.name }}
After=syslog.target

[Service]
{% if env -%}
Environment={% for key in env %}'{{key}}={{env[key]}}' {% endfor %}
{% endif -%}
{% if env_file -%}
EnvironmentFile={{ env_file }}
{% endif -%}

WorkingDirectory={{app_dir}}
User={{wsgi_user}}
ExecStart={{env_dir}}/bin/{{app.gunicorn_command|default(wsgi_gunicorn_command)}} {{app.module|default('wsgi:app')}} {{app.gunicorn_addopts|default('')}} --bind={{app.socket|default('unix:' + run_dir + '/' + app.name)}} --log-file={{log_dir}}/{{app.name}}-wsgi.log --name={{app.name}} --pid={{run_dir}}/{{app.name}}.pid --worker-class={{app.gunicorn_worker|default(wsgi_gunicorn_worker)}} --workers={{app.gunicorn_workers|default(wsgi_gunicorn_workers)}} {% if wsgi_reload %}--reload {% endif %} 
Restart=always
KillSignal=SIGQUIT
ExecReload?=/bin/kill -s HUP $MAINPID

[Install]
WantedBy=multi-user.target
